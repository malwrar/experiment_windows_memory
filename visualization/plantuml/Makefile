# Compiles plantuml into a variety of interesting formats.
#
# This Makefile is designed to be easily extended to add new formats, simply
# copy one of the blocks. Main targets like `all` and `clean` are at bottom of
# file.

# Define plantuml and all uml files.
CC  = plantuml
UML = $(wildcard *.uml)

# Output files
SVG  = $(UML:%.uml=%.svg)
ATXT = $(UML:%.uml=%.atxt)
UTXT = $(UML:%.uml=%.utxt)
ALL  = $(SVG) $(ATXT) $(UTXT)

# Output directories
SVG_DIR  = svg
ATXT_DIR = atxt
UTXT_DIR = utxt
ALL_DIR  = $(SVG_DIR) $(ATXT_DIR) $(UTXT_DIR)

# Compile uml into svgs
%.svg: %.uml
	@mkdir -p $(SVG_DIR)
	plantuml -tsvg $< -o $(SVG_DIR)

# Compile uml into ascii text
%.atxt: %.uml
	@mkdir -p $(ATXT_DIR)
	plantuml -tatxt $< -o $(ATXT_DIR)

# Compile uml into unicode text
%.utxt: %.uml
	@mkdir -p $(UTXT_DIR)
	plantuml -tutxt $< -o $(UTXT_DIR)

# Compile everything. If you add a new format, be sure to include it here!
all: $(ALL)

# Clean up all files generated by this Makefile
.PHONY: clean
clean:
	rm -rf $(ALL_DIR)
